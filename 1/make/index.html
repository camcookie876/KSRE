<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Camcookie QR Maker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --accent: #5cffe1;
      --bg: #121212;
      --fg: #f0f0f0;
      --card: #1f1f1f;
      --qr-bg: #ffffff;
      --qr-fg: #000000;
    }
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: var(--bg);
      color: var(--fg);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem;
      gap: 2rem;
    }
    textarea, input {
      width: 90%;
      max-width: 600px;
      padding: 1rem;
      border-radius: 8px;
      border: none;
      background: var(--card);
      color: var(--fg);
      font-size: 1rem;
      resize: vertical;
    }
    textarea { height: 200px; }
    button {
      background: var(--accent);
      color: #000;
      border: none;
      padding: 0.75rem 1.25rem;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s ease, transform 0.2s ease;
      font-weight: bold;
    }
    button:hover {
      background: #4eeed1;
      transform: scale(1.05);
    }
    #qrCanvas {
      background: var(--qr-bg);
      padding: 1rem;
      border-radius: 8px;
    }
    #link {
      font-size: 0.95rem;
      word-break: break-word;
      text-align: center;
      max-width: 90%;
    }
    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      align-items: center;
      justify-content: center;
    }
    label {
      font-size: 0.9rem;
      margin-top: -1rem;
    }
  </style>
</head>
<body>

  <h1>Camcookie QR Maker</h1>
  <textarea id="htmlInput" placeholder="Paste your HTML hereâ€¦"></textarea>

  <div class="row">
    <div>
      <label for="fgColor">QR Foreground</label>
      <input id="fgColor" type="color" value="#000000">
    </div>
    <div>
      <label for="bgColor">QR Background</label>
      <input id="bgColor" type="color" value="#ffffff">
    </div>
    <div>
      <label for="ecLevel">Error Correction</label>
      <select id="ecLevel">
        <option value="L">Low</option>
        <option value="M">Medium</option>
        <option value="Q">Quartile</option>
        <option value="H" selected>High</option>
      </select>
    </div>
  </div>

  <button id="generateBtn">Generate QR + Link</button>

  <div id="link"></div>
  <canvas id="qrCanvas" width="256" height="256"></canvas>

  <script src="https://cdn.jsdelivr.net/npm/qrcode-generator@1.4.4/qrcode.js"></script>
  <script>
    const htmlInput = document.getElementById('htmlInput');
    const fgColor = document.getElementById('fgColor');
    const bgColor = document.getElementById('bgColor');
    const ecLevel = document.getElementById('ecLevel');
    const generateBtn = document.getElementById('generateBtn');
    const linkDisplay = document.getElementById('link');
    const canvas = document.getElementById('qrCanvas');
    const ctx = canvas.getContext('2d');

    generateBtn.onclick = () => {
      const html = htmlInput.value.trim();
      if (!html) return;

      // Encode payload
      const encoded = btoa(unescape(encodeURIComponent(html)));
      const fullLink = `https://camcookie.github.io/MINI/1/view/#code=${encoded}`;

      linkDisplay.textContent = fullLink;

      // Generate QR
      const qr = qrcode(0, ecLevel.value);
      qr.addData(fullLink);
      qr.make();

      const tileW = canvas.width / qr.getModuleCount();
      const tileH = canvas.height / qr.getModuleCount();

      ctx.fillStyle = bgColor.value;
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      for (let row = 0; row < qr.getModuleCount(); row++) {
        for (let col = 0; col < qr.getModuleCount(); col++) {
          ctx.fillStyle = qr.isDark(row, col) ? fgColor.value : bgColor.value;
          ctx.fillRect(col * tileW, row * tileH, tileW, tileH);
        }
      }
    };
  </script>
</body>
</html>