<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Kahoot Portal</title>
  <style>
    /* … your existing styles … */
    #video {
      width: 100%;
      max-width: 400px;
      margin-top: 1em;
      border: 1px solid #ccc;
      display: none;
    }
    #debug {
      margin-top: .5em;
      font-size: .85em;
      color: #007acc;
      white-space: pre-wrap;
      background: #f3f3f3;
      padding: .5em;
    }
  </style>
  <!-- ZXing QR reader -->
  <script src="https://unpkg.com/@zxing/library@0.19.1"></script>
</head>
<body>

  <!-- … your existing markup … -->
  <button id="scanBtn">Scan QR Code</button>
  <div id="scan-message"></div>
  <video id="video" playsinline></video>
  <div id="debug"></div>

  <!-- your existing jsQR + build-time placeholders here -->

  <script>
    const codeReader = new ZXing.BrowserQRCodeReader();
    const debugEl    = document.getElementById('debug');
    const videoEl    = document.getElementById('video');
    const msgEl      = document.getElementById('scan-message');

    document.getElementById('scanBtn').addEventListener('click', () => {
      debugEl.textContent = '';
      msgEl.textContent   = 'Requesting camera…';
      videoEl.style.display = 'block';

      codeReader  
        .listVideoInputDevices()
        .then(devices => {
          log('Cameras found: ' + devices.map(d => d.label).join(', '));
          // pick back camera if you can
          const backCamera = devices.find(d => /back|rear/i.test(d.label)) || devices[0];
          log('Using device: ' + backCamera.label);

          return codeReader.decodeFromVideoDevice(
            backCamera.deviceId,
            'video',
            (result, err) => {
              if (result) {
                log('QR detected: ' + result.getText());
                codeReader.reset();
                finishScan(result.getText());
              }
              if (err && !(err instanceof ZXing.NotFoundException)) {
                // only log serious errors
                log('❌ Reader error: ' + err);
              }
            }
          );
        })
        .catch(err => {
          log('❌ Cannot start scanner: ' + err);
          msgEl.textContent = 'Camera start failed. Check console.';
        });
    });

    function finishScan(url) {
      window.location.href = url;
    }

    function log(msg) {
      console.log(msg);
      debugEl.textContent += msg + '\n';
    }
  </script>
</body>
</html>